# This is the shape of self.samples, without the samples axis, i.e. the shape # of the first dimension of a sample provided to dist.sample(). This way we can have it with # event to get a new rank event, then add the singleton event back at # -event_ndims - 1. samples_shape = tf.concat( [tf.shape(input=samples)[:-event_ndims - 1], tf.shape(input=samples)[tf.rank(samples) - event_ndims:]], axis=0) event *= tf.ones(samples_shape, dtype=event.dtype) event = tf.expand_dims(event, axis=-event_ndims - 1) samples *= tf.ones_like(event, dtype=samples.dtype) return event, samples