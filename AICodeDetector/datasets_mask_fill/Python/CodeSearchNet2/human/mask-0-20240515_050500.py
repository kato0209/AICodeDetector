# center = Max[Log[values]], with stop-gradient # The center hopefully keep the exponentiated <extra_id_0> small. It is <extra_id_1> # from the <extra_id_2> result, so putting <extra_id_3> gradient on it will not change the # <extra_id_4> result. We put stop gradient on to eliminate unnecessary computation. center = tf.stop_gradient(_sample_max(log_values)) # centered_values = exp{Log[values] - E[Log[values]]} centered_values = tf.math.exp(log_values - center) # log_mean_of_values = Log[ E[centered_values] ] + center # = Log[ E[exp{log_values - E[log_values]}] ] + center #