# This is the shape of self.samples, without the samples axis, i.e. the shape # of the <extra_id_0> of a <extra_id_1> to dist.sample(). This way we can <extra_id_2> it with # event to get a <extra_id_3> event, then add the singleton <extra_id_4> back at # -event_ndims - 1. samples_shape = tf.concat( [tf.shape(input=samples)[:-event_ndims - 1], tf.shape(input=samples)[tf.rank(samples) - event_ndims:]], axis=0) event *= tf.ones(samples_shape, dtype=event.dtype) event = tf.expand_dims(event, axis=-event_ndims - 1) samples *= tf.ones_like(event, dtype=samples.dtype) return event, samples